<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/gameTemplates/gameTemplate.js | api</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="RestAPI for the 3TC-web-project"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="api"><meta property="twitter:description" content="RestAPI for the 3TC-web-project"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/RPplanner-Team/API"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-initSocketIO">initSocketIO</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-sendMessageToGameMaster">sendMessageToGameMaster</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-sendMessageToPlayers">sendMessageToPlayers</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-sendMessageToSocket">sendMessageToSocket</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#gameelements">gameElements</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/gameElements/action.js~Action.html">Action</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/gameElements/announcement.js~Announcement.html">Announcement</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/gameElements/player.js~Player.html">Player</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/gameElements/role.js~Role.html">Role</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#gameelements-modules">gameElements/modules</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/gameElements/modules/mission.js~Mission.html">Mission</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/gameElements/modules/module.js~Module.html">Module</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#gameelements-triggers">gameElements/triggers</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/gameElements/triggers/horloge.js~Horloge.html">Horloge</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/gameElements/triggers/trigger.js~Trigger.html">Trigger</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#gametemplates">gameTemplates</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/gameTemplates/gameTemplate.js~GameTemplate.html">GameTemplate</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/gameTemplates/gameTemplate.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/* eslint-disable no-console */

import { Role } from &apos;../gameElements/role&apos;;
import { Player } from &apos;../gameElements/player&apos;;
import { Mission } from &apos;../gameElements/modules/mission&apos;;
import { Action } from &apos;../gameElements/action&apos;;

import { sendMessageToGameMaster, sendMessageToPlayers, sendMessageToSocket } from &apos;../socketio&apos;;

class GameTemplate {
  constructor(name) {
    this.name = name || null;
    this.gameId = null;
    this.started = false;
    this.actions = [];
    this.missions = [];
    this.roles = [];
    this.players = [];
    this.gameMasterSocketId = null;
    this.functions = {
      /**
      * Change game started property to true
      */
      startGame: () =&gt; {
        if (this.started) {
          console.log(&apos;already running game&apos;);
        } else if (this.howManyRoles() !== this.howManyPlayers()) {
          console.log(&apos;not enough players&apos;);
        } else {
          this.assignRoles();
          this.started = true;
          console.log(&apos;game starts !&apos;);
          this.players.forEach((player) =&gt; {
            const content = {
              role: player.role,
              name: player.name,
              alive: player.alive,
            };
            sendMessageToSocket(player.socketId, content);
          });
        }
      },

      /**
       * Change game started property to false
       */
      stopGame: () =&gt; {
        if (this.started) {
          // TODO: send update to players
          this.started = false;
          console.log(&apos;Game stopped&apos;);
        } else {
          console.log(&apos;Not started game cant be stopped&apos;);
        }
      },
    };
  }

  /**
   * set the game&apos;s id
   * @param {Number} gameId the game&apos;s id
   */
  setGameId(gameId) {
    this.gameId = gameId;
  }

  getRequest(content) {
    // eslint-disable-next-line no-prototype-builtins
    if (this.functions.hasOwnProperty(content.action)) {
      this.functions[content.action]();
    }
  }

  /**
   * Add the gameMaster socketId to the game
   * @param {Number} socketId The id of the gameMaster Socket
   */
  addGameMaster(socketId) {
    this.gameMasterSocketId = socketId;
  }

  /**
   * Create a new player and add it to players list
   * @param {String} name The player&apos;s name
   * @param {Number} socketId The player&apos;s socketid
   */
  addPlayer(name, socketId) {
    const p = new Player(name, socketId);
    this.players.push(p);
  }

  /**
   * Get the GM socket id
   */
  getGameMaster() {
    return this.gameMasterSocketId;
  }

  /**
   * Return how many players are in the game
   */
  howManyPlayers() {
    return this.players.length;
  }

  /**
   * Return how many roles are set
   */
  howManyRoles() {
    return this.roles.length;
  }

  /**
   * addRole is used to create a new Role to have in the current game template
   * @param {String} name Role name
   * @param {String} desc Role description
   */
  addRole(name, desc) {
    return this.roles.push(new Role(name, desc));
  }

  /**
   * addMission store a new mission in the current Game object
   * @param {String} name The mission&apos;s name
   * @param {Action} action The action which can be done to success the mission
   * @param {Role} role The Role which the mission is assigned to
   * @param {String} desc The missions description
   */
  addMission(name, action, role, desc) {
    return this.missions.push(new Mission(name, action, role, desc));
  }

  /**
   * addAction store an action in the current Game object.
   * @param {String} name Action&apos;s name
   * @param {Function} effect Effect of the action, function with
   * 2 parameters yoFurself:Player and others:[Player]
   * @param {boolean} affectYourself Is this action affecting yourself ?
   * @param {int} affectOthers How many other players are affected
   */
  addAction(name, effect, affectYourself, affectOthers) {
    return this.actions.push(new Action(name, effect, affectYourself, affectOthers));
  }

  /**
   * assignRole create players with already connected players in the game
   * @param {*} players players infos from the socket io client
   */
  assignRoles() {
    // Assign role to every players in the game.
    this.players.forEach((p) =&gt; {
      const role = this.roles.pop();
      p.setRole(role);
    });
  }
}

export default GameTemplate;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
